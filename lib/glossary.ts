/**
 * Score Schleifwerkzeuge - Kontrolliertes Vokabular / Glossar
 * Version: 1.0
 */

export const GLOSSARY = {
  anwendungen: [
    'Abrichten', 'Anfasen', 'Anrauen', 'Anschleifen', 'Aufrauen', 'Bürsten',
    'Definiertes Schliffbild', 'Egalisieren', 'Entgraten', 'Entlacken', 'Entrosten',
    'Entzundern', 'Feilen', 'Feinschleifen', 'Flachschleifen', 'Fräsen', 'Gleitschleifen',
    'Glätten', 'Gravieren', 'Hochglanzpolieren', 'Hochglanzverdichten', 'Honen',
    'Kalibrieren', 'Kantenbrechen', 'Kantenverrunden', 'Läppen', 'Materialabtragung',
    'Materialtrennung', 'Mattieren', 'Oberflächenfinish', 'Oberflächenveredelung',
    'Oberflächenvorbereitung', 'Polieren', 'Raspeln', 'Reinigen', 'Rundschleifen',
    'Satinieren', 'Säubern', 'Schärfen', 'Schleifen', 'Schruppschleifen', 'Schwabbeln',
    'Schweißnahtbearbeitung', 'Schweißnahtvorbereitung', 'Strukturieren', 'Superfinish',
    'Trennen', 'Trowalisieren', 'Innenrundschleifen', 'Kehlnahtbearbeitung', 'Besäumen',
    'Feinschliff', 'Grobschliff', 'Mittelschliff', 'Nachschliff', 'Vorschliff',
    'Glättung', 'Gravur', 'Kantenverrundung', 'Mattierung', 'Politur', 'Reinigung',
    'Schliff', 'Schruppschliff', 'Strukturierung', 'Nassschliff', 'Nassschleifen',
    'Flächenbearbeitung', 'Kantenbearbeitung'
  ],

  kategorien: [
    'Schleifbänder', 'Schleifpapier / Schleifrollen / Schleifbögen', 
    'Schleifscheiben / Schleifblätter', 'Trennscheiben', 'Fächerscheiben', 
    'Fiberscheiben', 'Diamanttrennscheiben', 'Spezielle Schleifscheiben', 
    'Vliesprodukte', 'Fräser / Frässtifte', 'Technische Bürsten', 'Schleifstifte', 
    'Schleifsteine', 'Fächerschleifer / Schleifmops', 'Feilen', 
    'Fächerräder / Schleifräder / Schleifwalzen', 'Graphitbelag', 'Klettbelag', 
    'Schleifteller / Schleifmittelträger', 'Sonstige Schleif-, Trenn- und Bohrwerkzeuge',
    'Schruppscheiben', 'Polierscheiben', 'Schleifbockscheiben', 'Grobreinigungsscheiben',
    'Gitterscheiben', 'Vliesscheiben', 'Kompaktscheiben', 'Schnellwechselscheiben',
    'Schleiftöpfe', 'Vliesbänder', 'Vliesstifte', 'Vliesräder',
    'Vliesscheiben / Fächerscheiben / Schleifmopteller', 
    'Vlies Combidiscs / Vlies Quick Change Discs', 'Vlies-Bögen / Handpads',
    'Vliesrollen', 'Rundbürsten', 'Rundbürsten mit Schaft', 'Handbürsten',
    'Topfbürsten mit Gewinde', 'Topfbürsten mit Schaft', 'Kegelbürsten mit Gewinde',
    'Kegelbürsten mit Schaft', 'Pinselbürsten mit Schaft', 'Walzenbürsten',
    'Innenbürsten', 'Tellerbürsten Composite', 'INOX-TOTAL', 'Zubehör',
    'Diamantfeilen', 'Nadelfeilen', 'Riffelfeilen', 'Werkstattfeilen',
    'Schlüsselfeilen', 'Sägefeilen', 'Handy-Feilen / Handy-Raspeln', 'Messerfeilen',
    'Entgratfeilen / Entgratklingen / Entgratsenker', 'Holzfeilen / Holzraspeln',
    'Angelfeilen', 'Drehbankfeilen', 'Metallfeilen', 'Karosseriefeilen / Lackhobel',
    'Huffeilen / Hufhobel', 'Hemmungsfeilen', 'Kabinettfeilen / -raspel',
    'Halterungen / Hüllen / Hefte', 'Keramikfaserfeilen', 'CORINOX-Feilen',
    'Sonstige Feilen', 'Fächerräder', 'Schleifräder', 'Schleifwalzen',
    'Bohrer / Lochwerkzeuge', 'Schleifhülsen / Schleifkappen / Schleifrolls',
    'Schleifschwämme / Schleifklötze', 'Schleifsterne', 'Tuchringe',
    'Sonstiges und Zubehör', 'Stichsägeblätter', 'Säbelsägeblätter', 'Kreissägeblätter',
    'Breitbänder', 'Feilenbänder', 'Bänder für Handbandschleifer',
    'Langbänder & Kantenschleifbänder', 'Parkettschleifbänder',
    'Bänder für Rohrbandschleifer', 'Bänder für Schärfmaschinen', 'Schmalbänder'
  ],

  werkstoffe: [
    'Aluguss', 'Aluminium', 'Bleche', 'Chromstahl', 'Nickelstahl', 'Chrome',
    'Edelstahl', 'Guss', 'Hochlegierte Stähle', 'Kohlenstoffstahl', 'Legierte Stähle',
    'Legierungen', 'Leichtmetalle', 'NE-Metalle', 'Sandwichmaterial', 'Stahl', 'Titan',
    'Abrasive Materialien', 'Altbeton', 'Altbeton armiert', 'Asphalt',
    'Baustellenmaterialien', 'Beton', 'Bitumen', 'Dachziegel', 'Estrich',
    'Estrichfugen', 'Feinsteinzeug', 'Fliesen', 'Frischbeton', 'Füller', 'Gasbeton',
    'Gips', 'Gipskartonwände', 'Glas', 'Granit', 'Harte Bodenfliesen',
    'Harte Wandfliesen', 'Hartes Feinsteinzeug', 'Hartgestein', 'Kacheln',
    'Kalksandstein', 'Keramik', 'Klinker', 'Marmor', 'Mauerwerk', 'Naturstein',
    'Ofenkacheln glasiert', 'Porenbeton', 'Porphyr/Quarzit', 'Porzellan', 'Putz',
    'Sandstein', 'Schamotte', 'Stein', 'Terrazzo', 'Ziegel', 'Beschichtete Platten',
    'Brennholz', 'Grünholz', 'HPL Platten', 'Hartholz', 'Holz mit Nägeln',
    'Holzwerkstoffe', 'Konstruktionsholz', 'Küchenarbeitsplatten', 'Laminat',
    'MDF Platten', 'Multiplexplatten', 'Spanplatten', 'Sperrholz', 'Tischlerplatten',
    'Weichholz', 'Coatings', 'Farbe', 'Gel-Coats', 'Grundierung', 'Gummi',
    'Klebstoff', 'Lack', 'Leim', 'Spachtelmasse', 'Epoxidharz',
    'Faserverstärkte Kunststoffe', 'Kompositwerkstoffe', 'Kunststoff', 'Leder',
    'Metall', 'Holz', 'Alu'
  ],

  maschinentypen: [
    'Schleifklotz', 'Handpad', 'Handfeile', 'Handschleifbogen', 'Schleifvlies',
    'Schleifschwamm', 'Poliertuch', 'Exzenterschleifer', 'Schwingschleifer',
    'Dreieckschleifer', 'Bandschleifer', 'Geradschleifer', 'Winkelschleifer',
    'Drehzahlgeregelter Winkelschleifer', 'Bohrmaschine', 'Poliermaschine',
    'Satiniermaschine', 'Kehlnahtschleifer', 'Parkettschleifer', 'Mauerschlitzfräse',
    'Fugenschneider', 'Akkuschrauber', 'Stichsäge', 'Säbelsäge', 'Handbandfeile',
    'Breitbandschleifmaschine', 'Kantenschleifmaschine', 'Tischschleifmaschine',
    'Ständerschleifmaschine', 'Tellerschleifmaschine', 'Bandschleifmaschine',
    'Schleifbock', 'Centerless-Schleifmaschine', 'Flachschleifmaschine',
    'Langbandschleifmaschine', 'Profilschleifmaschine', 'Trenn- und Schleifmaschine',
    'Hubbalkenschleifmaschine', 'Rohrschleifmaschine', 'Profilbandschleifmaschine',
    'Kantenfräsmaschine', 'Langhals-Deckenschleifer', 'Glas- & Steinbearbeitungsmaschine',
    'Roboter-Schleifanlage', 'CNC-Schleifmaschine', 'Automatisierte Polieranlage',
    'Automatisches Entgrat-/Finishsystem', 'Entgratstation', 'Polierstation',
    'Finishmodul', 'Kombi-Schleifstation', 'Cobot-Schleifer',
    'Laserunterstütztes Schleifsystem', 'Druckluftschleifer', 'Elektroschleifer',
    'Akku-Schleifer', 'Hydraulik-Schleifer', 'Magnetband-Schleifmodul',
    'Vibrations-Schleifer'
  ]
}

/**
 * Mappt freien Text auf Glossar-Begriffe
 */
export function mapToGlossary(text: string): {
  applications: string[]
  categories: string[]
  materials: string[]
  machines: string[]
} {
  const lowerText = text.toLowerCase()
  
  const result = {
    applications: [] as string[],
    categories: [] as string[],
    materials: [] as string[],
    machines: [] as string[]
  }

  // Anwendungen
  for (const term of GLOSSARY.anwendungen) {
    if (lowerText.includes(term.toLowerCase())) {
      result.applications.push(term)
    }
  }

  // Kategorien
  for (const term of GLOSSARY.kategorien) {
    if (lowerText.includes(term.toLowerCase())) {
      result.categories.push(term)
    }
  }

  // Werkstoffe
  for (const term of GLOSSARY.werkstoffe) {
    if (lowerText.includes(term.toLowerCase())) {
      result.materials.push(term)
    }
  }

  // Maschinentypen
  for (const term of GLOSSARY.maschinentypen) {
    if (lowerText.includes(term.toLowerCase())) {
      result.machines.push(term)
    }
  }

  // Deduplizieren
  result.applications = [...new Set(result.applications)]
  result.categories = [...new Set(result.categories)]
  result.materials = [...new Set(result.materials)]
  result.machines = [...new Set(result.machines)]

  return result
}

/**
 * Gibt Produktempfehlungen basierend auf gemappten Begriffen
 */
export function getProductRecommendations(mapped: ReturnType<typeof mapToGlossary>): string[] {
  const recommendations: string[] = []

  // Basierend auf Materialien
  if (mapped.materials.some(m => ['Edelstahl', 'Chromstahl', 'Nickelstahl'].includes(m))) {
    recommendations.push('Trennscheiben 1,0–1,6 mm Inox')
    recommendations.push('Fächerscheiben K60/K80 Zirkon (Edelstahl)')
  }

  if (mapped.materials.some(m => ['Stahl', 'Kohlenstoffstahl'].includes(m))) {
    recommendations.push('Fächerscheiben K60/K80 Keramikkorn')
    recommendations.push('Fiberscheiben + Stützteller')
  }

  if (mapped.materials.some(m => ['Aluminium', 'Aluguss', 'Leichtmetalle'].includes(m))) {
    recommendations.push('Schleifbänder für Aluminium')
    recommendations.push('Vlies Medium/Fine (Aluminium-Finish)')
  }

  // Basierend auf Anwendungen
  if (mapped.applications.some(a => ['Polieren', 'Hochglanzpolieren', 'Oberflächenfinish'].includes(a))) {
    recommendations.push('Vlies Fine/Extra Fine')
    recommendations.push('Polierscheiben')
  }

  if (mapped.applications.some(a => ['Entgraten', 'Kantenbrechen'].includes(a))) {
    recommendations.push('Fiberscheiben K36/K60')
    recommendations.push('Fächerscheiben K40/K60')
  }

  if (mapped.applications.some(a => ['Schweißnahtbearbeitung', 'Schweißnahtvorbereitung'].includes(a))) {
    recommendations.push('Schruppscheiben 4–6 mm')
    recommendations.push('Fächerscheiben K40/K60 (Schweißnaht)')
  }

  // Immer Schleifbänder inkl. Sondermaße anbieten
  if (recommendations.length > 0) {
    recommendations.push('Schleifbänder inkl. Sondermaße')
  }

  return [...new Set(recommendations)].slice(0, 5)
}
