FIBU Modul - √Ñnderungsprotokoll
================================

Version 1.0.0 - November 2025
-----------------------------

[NEUE FEATURES]

‚úÖ EK-Rechnungen System
  - Vollst√§ndige Verwaltung von Lieferantenrechnungen
  - E-Mail-Import mit PDF-Parsing (Gemini AI)
  - Duplikate-Erkennung
  - Beleg-Anzeige (PDF aus MongoDB)
  - Filter: Kreditor, Zahlung, Suche
  - Sortierung: Datum, Lieferant, Betrag, Kreditor
  - Aktionen: Beleg, Zur√ºck in Zuordnung, L√∂schen
  - 0‚Ç¨-Rechnungen automatisch in Zuordnung

‚úÖ VK-Rechnungen System
  - JTL-Integration f√ºr RE-Rechnungen
  - Externe XRE-* Rechnungen (Amazon/eBay)
  - MongoDB-Lookup f√ºr Rechnungsnummer + Kunde
  - Status: Bezahlt/Offen
  - Filter nach Quelle und Status

‚úÖ Zahlungen System
  - Multi-Source: PayPal, Amazon Payment, eBay, Commerzbank, Postbank
  - 1000 Zahlungen mit 5-Minuten-Cache
  - Bestellnummer f√ºr Amazon/eBay angezeigt
  - Filter: Anbieter, Zuordnung, Richtung
  - Horizontales Scrolling f√ºr alle Spalten

‚úÖ Kreditor-Zuordnung
  - Intelligente Vorschl√§ge (Name-Matching)
  - Batch-Zuordnung
  - Auto-Zuordnung: Alle Rechnungen vom gleichen Lieferanten
  - Mapping speichern f√ºr zuk√ºnftige Rechnungen
  - Edit-Funktion mit Modal
  - Beleg-Anzeige integriert

‚úÖ Kreditoren-Verwaltung
  - CRUD-Funktionen (Anlegen, Bearbeiten, L√∂schen)
  - 117 Kreditoren aus CSV importiert
  - Suche nach Nummer oder Name
  - Kategorien 1-4

‚úÖ Monats-√úbersicht
  - KPI-Dashboard mit kompakten 2-Spalten-Kacheln
  - Fortschrittsbalken
  - Zufallszitat (Philosophen feat. Reality-TV-Stars)
  - Direkte Links von KPIs zu Detail-Views
  - Export-Button wenn Monat abschlie√übar

‚úÖ Tennet/10it Export
  - SKR04-konform
  - Doppelte Buchf√ºhrung (SOLL/HABEN)
  - Alle Belege: VK, EK, Zahlungen
  - CSV-Format f√ºr Tennet/Addison

‚úÖ Bank-Import
  - Postbank CSV parsen
  - Geh√§lter automatisch kategorisieren

‚úÖ Fuzzy-Matching
  - Automatische Zuordnung Zahlungen ‚Üí Rechnungen
  - Betrag + Datum + Rechnungsnummer Matching
  - Amazon Payment Regel: NUR zu XRE-* Rechnungen
  - Confidence-Score System

‚úÖ Custom Date Range Picker
  - Voreinstellungen + Custom-Modus
  - Von/Bis Datum frei w√§hlbar

[BUG FIXES]

üîß Amazon Payment Zuordnung
  - Problem: 221 falsche Zuordnungen zu RE-Rechnungen
  - Ursache: Fuzzy-Matching ohne Amazon-Regel
  - Fix: Regel implementiert (nur XRE-* Rechnungen)
  - Fix-API erstellt: /api/fibu/fix-amazon-zuordnung
  - Status: Alle falschen Zuordnungen entfernt

üîß Kreditoren Import
  - Problem: 70032 = "Werkstatt Holger St√∂lting" statt "Bosch Power Tools"
  - Ursache: Alte Kreditoren nicht gel√∂scht, falsche Datenbank
  - Fix: Import-Script korrigiert (richtige DB, l√∂scht ALLE alten)
  - Status: 117 Kreditoren exakt aus CSV

üîß Externe VK-Rechnungen
  - Problem: Rechnungsnummer + Kunde fehlten
  - Ursache: MongoDB-Lookup fehlte
  - Fix: API erweitert mit MongoDB-Daten
  - Status: XRE-5636, Johannes Ruckwied, etc. angezeigt

üîß EK-Rechnungen Duplikate
  - Problem: Robert Bosch 3x, CUMI AWUKO 3x
  - Ursache: Kein Duplikate-Check
  - Fix: Duplikate-Erkennung in API implementiert
  - Status: 5 Duplikate entfernt

üîß Filter Wei√ü-auf-Wei√ü
  - Problem: Dropdown-Text nicht lesbar
  - Ursache: Fehlende CSS-Klassen
  - Fix: bg-white text-gray-900 hinzugef√ºgt
  - Status: Alle Dropdowns lesbar

üîß EK-Rechnungen fehlten
  - Problem: Tab zeigte "Keine Rechnungen"
  - Ursache: details.ekRechnungen nicht in API-Response
  - Fix: ekRechnungen zu details hinzugef√ºgt
  - Status: Alle 107 EK-Rechnungen sichtbar

üîß Zahlungen-API Performance
  - Problem: 40 Sekunden Ladezeit
  - Ursache: Keine Server-Side Cache
  - Fix: 5-Minuten Cache implementiert
  - Status: 3 Sekunden Ladezeit (13x schneller)

üîß VK-Rechnungen Statistik
  - Problem: 0‚Ç¨ Gesamtumsatz, 0 zugeordnete Zahlungen
  - Ursache: Felder nicht in API-Response
  - Fix: gesamtUmsatz + zugeordnet/nichtZugeordnet hinzugef√ºgt
  - Status: 109.743‚Ç¨ Gesamtumsatz, 3783 zugeordnet

üîß Edit-Button nicht sichtbar
  - Problem: Au√üerhalb des sichtbaren Bereichs
  - Ursache: Eigene Spalte ganz rechts
  - Fix: In "Aktionen"-Spalte verschoben (üìÑ PDF | ‚úèÔ∏è)
  - Status: Alle Buttons sichtbar

üîß Auto-Zuordnung JavaScript Fehler
  - Problem: "confirmed is not defined"
  - Ursache: Variable im falschen Scope
  - Fix: let confirmed = false au√üerhalb
  - Status: Funktioniert (7 Rechnungen Robert Bosch zugeordnet)

[OPTIMIERUNGEN]

‚ö° Performance
  - Server-Side Cache f√ºr FIBU √úbersicht (5 Min)
  - Server-Side Cache f√ºr Zahlungen (5 Min)
  - MongoDB-Lookup optimiert

‚ö° UI/UX
  - Kompaktere Kacheln (2-Spalten statt full-width)
  - Dropdown-Gr√∂√üe reduziert (w-40)
  - Sticky Header f√ºr Tabellen
  - Horizontal Scrolling aktiviert

‚ö° Code-Qualit√§t
  - TypeScript f√ºr alle API-Routes
  - Duplikate-Check in allen Listen
  - Error-Handling verbessert
  - Console-Logs f√ºr Debugging

[BEKANNTE PROBLEME]

‚ö†Ô∏è PDF-Parsing nicht 100% akkurat
‚ö†Ô∏è Fuzzy-Matching kann falsch-positive generieren
‚ö†Ô∏è Cache-Invalidierung nur manuell per Button

[STATISTIK]

üìä Aktueller Stand:
  - 117 Kreditoren
  - 108 gepr√ºfte EK-Rechnungen
  - 22 EK-Rechnungen in Zuordnung
  - 2769 VK-Rechnungen
  - 4477 Zahlungen (3783 zugeordnet)
  - 221 falsche Amazon-Zuordnungen korrigiert
  - 5 Duplikate entfernt

[MIGRATION NOTES]

Beim Forken beachten:
1. MONGO_URL in .env anpassen
2. JTL_SQL_* Credentials anpassen
3. GEMINI_API_KEY f√ºr PDF-Parsing
4. Kreditoren neu importieren: node scripts/import-kreditoren-csv.js
5. Fix-API einmalig ausf√ºhren: curl -X POST /api/fibu/fix-amazon-zuordnung

---
Ende Changelog