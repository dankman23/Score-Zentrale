<analysis>
The trajectory documents a multi-faceted development and debugging session on the Score-Zentrale Next.js application. The work commenced by addressing a critical bug where the Kaltakquise (cold acquisition) autopilot only functioned when a user was active on the webpage. This was resolved by replacing the frontend-based  polling with a robust, persistent backend worker using a Node.js script managed by Supervisor. This ensured the autopilot runs 24/7, independent of frontend activity.

Following this, the engineer addressed several user-reported bugs, including an input field limitation and a hardcoded data-fetching limit that prevented all company records from being displayed.

The primary focus then shifted to a major feature enhancement of the FIBU (financial accounting) module. Guided by extensive user input comparing the desired functionality to the Lexoffice software, the engineer began implementing a sophisticated auto-matching system. This involved creating a dual-matching engine to associate financial transactions with *both* a document (Beleg) and an account (Konto). A significant debugging effort was undertaken to create a data-mapping layer () to normalize transaction data from various sources (Amazon, PayPal, etc.) before processing.

The final phase involved building the frontend UI for manual assignments while simultaneously debugging the backend matching logic. A critical issue was identified: document matching was failing because the source collection () was empty. The user's last request was to pause development and create comprehensive documentation to prepare the project for forking.

All future communication should be in **German**.
</analysis>

<product_requirements>
The primary goal is to build a comprehensive, automated financial accounting (FIBU) module within the Score-Zentrale application, inspired by the functionality of Lexoffice.

**Key Requirements:**
1.  **Dual-Assignment:** Every financial transaction must be associated with both a corresponding document (Beleg), such as an invoice, and a financial account (Konto), such as revenue or fees.
2.  **Automated Matching:** Implement a robust, learning-based system to automatically perform this dual-assignment. The system should use various strategies:
    *   Matching invoice/order numbers from transaction descriptions.
    *   Rule-based mapping for known fees (e.g., PayPal fees).
    *   Learning from manual user assignments to improve future suggestions.
3.  **Manual Override:** Provide a clear and intuitive frontend interface allowing users to manually assign or correct the automated assignments for both documents and accounts.
4.  **Data Persistence:** All transactions, documents, and their associations must be stored permanently in the MongoDB database.
5.  **Data Export:** Create an export function to generate a CSV file compatible with the 10it (Addison) accounting software, following the DATEV format.
6.  **Reliable Autopilot:** Ensure the Kaltakquise autopilot runs continuously in the background, independent of user browser sessions.
</product_requirements>

<key_technical_concepts>
- **Framework:** Next.js (App Router)
- **Database:** MongoDB
- **Background Jobs:** Node.js script managed by autopilot-worker                 RUNNING   pid 27, uptime 0:00:02
code-server                      STOPPED   Not started
jtl-import                       STOPPED   Not started
mongodb                          RUNNING   pid 28, uptime 0:00:02
nextjs                           RUNNING   pid 30, uptime 0:00:02
nginx-code-proxy                 STARTING  
supervisor>  for persistent, asynchronous tasks (Autopilot Worker).
- **Data Normalization:** A dedicated data-mapping layer () to create a consistent data structure from disparate sources (Amazon, PayPal, Bank CSVs) before processing.
- **Accounting Logic:** Implementation of a dual-matching engine and a learning classifier for automated financial record-keeping.
- **Styling & UI:** React components, , and existing shadcn/ui and Tailwind CSS.
</key_technical_concepts>

<code_architecture>
The application is a Next.js monolith. The recent work has focused on creating a robust background processing system and a modular, extensible architecture for the new FIBU (financial accounting) features.

**Directory Structure:**


**File Analysis:**

- ** & **
  - **Importance:** These files create a persistent background worker process that solves the critical bug of the autopilot only running when the user is on the website. The script continuously calls the  API, and the  file ensures Supervisor keeps it running.
  - **Changes:** Both were created from scratch.

- ****
  - **Importance:** This is a crucial new utility for the FIBU module. It solves the core problem of inconsistent data formats by normalizing raw transaction data from various MongoDB collections (Amazon, PayPal, etc.) into a single, unified  object.
  - **Changes:** Created from scratch to map fields like  and  to a common  and .

- ****
  - **Importance:** This is the heart of the new accounting logic. It orchestrates the process of finding both a  (document) and a  (account) for a given transaction, fulfilling the Dual-Assignment requirement.
  - **Changes:** Created from scratch to replace the older, single-assignment logic.

- ****
  - **Importance:** The new API endpoint that exposes the 's functionality. This is used for the large-scale re-processing of all historical transactions.
  - **Changes:** Created from scratch.

- ****
  - **Importance:** A new, enhanced UI component for manual transaction assignment. It's designed to allow the user to select both a document and an account in a single interface, directly supporting the core FIBU requirements.
  - **Changes:** Created from scratch as a replacement for the older, simpler .

- ****
  - **Importance:** The main frontend page.
  - **Changes:** The hardcoded  for fetching companies was removed. The  attribute on the autopilot limit input was removed to fix a UI bug. The original  logic for the autopilot is now obsolete but likely still present in the code.
</code_architecture>

<pending_tasks>
- **Fix Beleg Matching:** The root cause of document matching failure needs to be addressed. The  collection is empty, so the process of populating it with invoices from JTL or other sources must be found and fixed.
- **Complete Frontend UI:** Fully integrate the  and  into the  and  to allow seamless manual assignment and correction.
- **Implement 10it Export:** Begin Phase 3 of the FIBU plan, which involves creating the API and logic to export accounting data in the DATEV/10it-compatible CSV format.
</pending_tasks>

<current_work>
Immediately before the summary request, the work was split between two parallel tasks, prompted by the user's request to do both:

1.  **Backend Re-Run & Debugging:** A large-scale re-run of the new dual-matching logic was executing in the background on all 8,541 transactions for October 2025. This successfully assigned accounts to over 97% of transactions. In parallel, the engineer was actively debugging why **zero** documents (Belege) were being matched. This led to the discovery that the source collection for documents, , is empty. The PayPal matching logic was also being refined to improve its success rate.

2.  **Frontend Development:** The engineer was building out the user interface for manual assignments to fulfill the user's request for clear menus and linking capabilities. This involved creating new React components:  for document details and  to display a list of documents. The next step was to integrate these new components and the previously created  into the main FIBU dashboard.

The final user message pivoted away from this work, explicitly requesting the creation of comprehensive documentation to prepare the project for forking.
</current_work>

<optional_next_step>
Create a comprehensive  file to document the project setup, architecture, and environment, as explicitly requested by the user to prepare the project for forking.
</optional_next_step>

<quotes>
bitte ausführliche und gute übergBE ZUNM FORKING MIT DEN tXT DATEIN JETZT EBEN AUSFÜLLEN
</quotes>
