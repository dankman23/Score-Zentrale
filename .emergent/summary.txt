<analysis>
The trajectory chronicles the evolution of the Score-Zentrale application's financial accounting (FIBU) module. The work began with a user request to model the FIBU section after the Lexoffice software, leading to a multi-phase development plan.

A significant portion of the work involved deep backend debugging and architectural refactoring. An initial problem of missing invoice data ( collection being empty) was traced to SQL errors in the JTL integration API. This was resolved by creating a robust sync mechanism that populates the MongoDB collection from various sources, which also drastically improved performance by introducing a caching layer.

A critical turning point was the user's concern about data integrity. This led to a major refactoring of several data import APIs (for external invoices, bank transactions, etc.). The engineer replaced unsafe  operations using  (which overwrote manual user assignments) with a secure pattern using  or conditional updates that explicitly protect linkage fields. This established data persistence and safety as a core architectural principle.

The focus then shifted to the frontend, where the existing tab structure was consolidated into a more logical 6-tab layout. Extensive debugging was also performed on the eBay payment integration, revealing issues with disabled production keys and incorrect credential types (Auth'n'Auth vs. OAuth 2.0). The integration was ultimately paused.

Finally, development began on a Master-Detail UI for the Umsätze (Transactions) and EK-Belege (Incoming Documents) tabs. The work was paused by the user's explicit request to create this comprehensive summary to prepare the project for forking.

The user communicates in **German**, and all future interactions should be in German.
</analysis>

<product_requirements>
The goal is to build a comprehensive, automated financial accounting (FIBU) module inspired by Lexoffice functionality.

**Core Features:**
1.  **UI/UX Overhaul:** Refactor the existing FIBU interface into a new 6-tab structure: Übersicht (Overview), EK-Belege (Incoming Invoices), VK-Belege (Outgoing Invoices), Umsätze (Transactions), Zuordnung (Assignment), and Einstellungen (Settings).
2.  **Master-Detail Layout:** Implement a two-panel layout for the Belege and Umsätze tabs, showing a list of items on the left and a detailed view/editor on the right.
3.  **Data Integrity and Persistence:** This is a critical, non-negotiable requirement. Data, once imported into MongoDB from sources like JTL (SQL), must be treated as permanent. Manual associations between transactions and documents must never be lost or overwritten by subsequent data syncs.
4.  **Performance:** The application must be fast. Data should be cached in MongoDB to avoid slow, repetitive calls to external sources like the JTL SQL database.
5.  **Data Import:** The system must handle importing data from various sources:
    *   VK-Belege (Outgoing Invoices) from JTL.
    *   EK-Belege (Incoming Invoices) via email/manual upload.
    *   Transactions from PayPal, Amazon, Mollie, Commerzbank, and eBay.
6.  **DATEV Export:** Implement a feature to export financial data into a CSV format compatible with 10it/Addison software.
</product_requirements>

<key_technical_concepts>
- **Framework:** Next.js (App Router), React
- **Database:** MongoDB
- **Data Persistence Strategy:** A cache-and-protect pattern. Data is fetched once from a primary source (e.g., JTL SQL) and stored in MongoDB. Subsequent updates are designed to be non-destructive, using  or conditional updates to protect user-generated data like manual transaction-document links.
- **UI Architecture:** Master-Detail view pattern for data presentation and editing.
- **External API Integration:** Connecting to JTL (MSSQL), eBay, and Mollie REST APIs.
</key_technical_concepts>

<code_architecture>
The application is a Next.js monolith with a backend API layer and a React-based frontend. The architecture has been refactored to prioritize performance and data safety through a MongoDB caching layer.

**Directory Structure (Relevant Files):**


**File Analysis:**

-   ****
    -   **Importance:** This is the main frontend component for the entire FIBU module. It manages the tab navigation and renders the corresponding view for each section.
    -   **Changes:** Heavily refactored multiple times to consolidate the original 8+ tabs into the user-specified 6-tab structure (Übersicht, EK-Belege, VK-Belege, Umsätze, Zuordnung, Einstellungen). It now renders the new Master-Detail components. A React hydration error caused by random quote generation on the server was also fixed here.

-   ** & **
    -   **Importance:** These APIs handle importing data from external sources. They were identified as a major risk to data integrity.
    -   **Changes:** The core logic was changed from a dangerous  which overwrote all data, to a safe pattern. Now, the code checks if a document/transaction exists. If it doesn't, it's inserted. If it does, only non-critical fields are updated, and any records with existing manual assignments are skipped entirely, thus preserving user work.

-   ****
    -   **Importance:** A new API created to solve the problem of empty invoice collections. It acts as a central aggregator.
    -   **Changes:** Created from scratch. It fetches data from various sources (like  and the JTL  API) and consolidates them into the  collection, which is used by the matching engine. This also now uses the safe update pattern.

-   ** & **
    -   **Importance:** These are new, central components for the revamped UI, implementing the Lexoffice-style Master-Detail layout.
    -   **Changes:** Created from scratch. They provide a two-panel view with a filterable list on the left and a details/assignment panel on the right. This represents the beginning of the final UI vision.

-   ** & **
    -   **Importance:** These files manage the eBay integration.
    -   **Changes:** The  file was repeatedly updated with new eBay tokens and switched from  to . The  was modified to fix the API endpoint URL and the authentication method. Despite these efforts, the integration remains non-functional due to a persistent 404 error, likely related to incorrect token type (Auth'n'Auth vs. OAuth 2.0).
</code_architecture>

<pending_tasks>
- **Finalize Master-Detail Layouts:**
  - Implement the Master-Detail view for the VK-Belege tab.
  - Adjust the Umsätze (Zahlungen) layout to have a wider list and a slide-in detail panel, per the user's latest feedback.
- **Implement 10it/DATEV Export:** Create the API and frontend button for CSV data export.
- **Fix eBay Integration:** The integration is paused. It requires generating a proper OAuth 2.0 user token and potentially further debugging with eBay support.
- **Create Project Documentation:** Fulfill the user's final request to create a  file summarizing the project for forking.
</pending_tasks>

<current_work>
The most recent work focused on a major frontend overhaul to implement a Master-Detail UI, mirroring the Lexoffice software.

1.  **Hydration Error Fix:** A blocking React hydration error, caused by server-side random quote generation in , was identified and resolved by moving the quote generation to a  hook, ensuring it only runs on the client.

2.  **Umsätze (Transactions) View:** The  component was created and integrated. After initial debugging to fix data loading, it successfully displayed a list of transactions on the left and a detail/assignment panel on the right, proving the concept.

3.  **EK-Belege (Incoming Invoices) View:** Following the success with transactions, the  component was created and integrated, establishing the same UI pattern for incoming invoices.

4.  **New User Feedback & Pivot:** Immediately after the EK-Belege view was implemented, the user provided new visual feedback indicating that the layout for Umsätze should be different: a wider, almost full-screen list with a detail panel that slides in from the right upon clicking an item, rather than being permanently visible.

5.  **Final Request:** Before development on the layout adjustment could begin, the user's very next message was **bitte ordentlich zusammenfassen fürs forken** (please summarize properly for forking), which initiated the creation of this summary document.
</current_work>

<optional_next_step>
Adjust the  component to match the user's latest feedback: change the layout to a wider list and make the detail panel a slide-in element that appears on click.
</optional_next_step>
