<analysis>
The user is a German-speaking software engineer, and the next agent **must** respond in **German**.

The trajectory documents an extensive debugging and feature enhancement sprint on a Kaltakquise (Cold Acquisition) Autopilot module. The user reported that the Autopilot was not sending emails and its status was unclear. The AI engineer initiated a deep-dive investigation, revealing several critical issues.

First, a data architecture problem was found: three separate MongoDB collections (, , ) were causing data silos, preventing the Autopilot's work from appearing in the UI. This was resolved by migrating all APIs to a single  collection.

Next, a series of complex, nested bugs within the Autopilot's  process were systematically identified and resolved. This involved:
1.  **Fixing a failing LLM API:** The  service was returning 404s. The engineer switched to a user-provided OpenAI key, which required creating a new  and debugging a persistent webpack cache issue caused by a duplicate  file.
2.  **Resolving ID mismatches:** The application was inconsistently using MongoDB's  (ObjectID) and a custom uid=0(root) gid=0(root) groups=0(root) (UUID string), causing Prospect not found errors. This was fixed by standardizing the use of the correct ID field across API calls.
3.  **Breaking an infinite loop:** The Autopilot was repeatedly processing the same prospects that had no email addresses. The final fix was implementing an  flag in the database to mark and ignore failed prospects, allowing the pipeline to advance.

Finally, the AI addressed several UI/UX requests, including adding a BCC to emails, overhauling the email template to use HTML, creating a proper Postausgang (Outbox) view, and fixing UI bugs in the Autopilot controls. The work concluded just after fixing a minor UI bug on the daily limit input, before starting the final documentation for forking.
</analysis>
<product_requirements>
The project's goal is to build and maintain a highly automated application with two primary modules:

**1. Financial Accounting (FIBU) Automation:**
This module automates the reconciliation of payments from sources like Amazon, PayPal, and Commerzbank with internal sales invoices. The system was successfully enhanced to achieve a 100% automatic association rate by implementing a multi-layered rules engine, including regex-based matching for invoice/order numbers, effectively eliminating manual accounting work for the specified period.

**2. Outbound Cold Acquisition (Kaltakquise) Pipeline:**
This module is a three-stage B2B lead generation engine.
-   **Stage 1 (Find):** The DACH-Crawler automatically finds potential customer websites.
-   **Stage 2 (Analyze):** An AI-powered service () performs a deep analysis of the websites to extract business intelligence like contacts and product needs.
-   **Stage 3 (Engage):** A service () generates personalized HTML outreach emails.
An Autopilot feature fully automates this pipeline. The most recent work focused heavily on debugging and refining this Autopilot to make it fully functional, ensuring it correctly finds, analyzes, and contacts new leads without getting stuck.
</product_requirements>
<key_technical_concepts>
- **Backend:** Next.js (App Router), TypeScript, API Routes
- **Frontend:** React (, ) in a single large client component ()
- **Database:** MongoDB
- **AI/LLM Integration:** OpenAI API for deep company analysis and email generation.
- **Email:**  for SMTP dispatch.
- **Core Logic:**
    - Chained API calls for the outbound pipeline (Crawl → Analyze → Email).
    - Complex database queries (, , ) to manage the Autopilot prospect queue.
    - Stateful Autopilot logic with error handling and retry-skipping ( flag).
</key_technical_concepts>
<code_architecture>
The application is a Next.js monolith. A large client component () handles the UI for all modules, while the backend consists of API routes and services.

**Directory Structure:**


**Key Files & Recent Changes:**

- ****
  - **Importance:** The core of the Autopilot. This endpoint is periodically called to execute one cycle of the find-analyze-engage pipeline.
  - **Changes:** This file was the subject of intense debugging. The query to find the next prospect was significantly improved to filter out already-attempted prospects using an  flag. Logic was added to handle cases where prospects have no email addresses, preventing infinite loops. The API calls to  and  were corrected to pass the proper uid=0(root) gid=0(root) groups=0(root) field ( vs uid=0(root) gid=0(root) groups=0(root)).

- ****
  - **Importance:** Contains the logic to crawl a website and use an LLM to extract business data.
  - **Changes:** A critical bug was found where two versions of this file existed. The correct one () was modified to use a new  instead of a failing . The LLM call was also corrected to properly parse the JSON response.

- ****
  - **Importance:** New file created to encapsulate interaction with the OpenAI API.
  - **Changes:** Created from scratch to replace the failing  library. Uses a user-provided API key from .

- ****
  - **Importance:** Contains the LLM prompts for generating personalized outreach emails.
  - **Changes:** The prompts were completely overhauled to generate rich HTML emails, including bold text, links, a full signature, and specific business-related content as requested by the user.

- ****
  - **Importance:** Handles the actual sending of emails via SMTP.
  - **Changes:** Fixed an SMTP connection bug by changing the port from 465 to 587 and enabling  for STARTTLS. The BCC field was updated to include a second address.

- ****
  - **Importance:** The massive central UI component.
  - **Changes:** Refactored to display Posteingang (Inbox) and Postausgang (Outbox) as persistent tab views instead of modals, which involved significant JSX restructuring. An  was added to the Outbox to show the full email body on click. A UI bug in the Autopilot's daily limit input field was fixed to allow proper number entry and correct styling.
</code_architecture>
<pending_tasks>
- **Finalize Handover Documentation:** The primary task is to update the  file with a comprehensive summary of the project architecture, setup instructions, and feature overview to prepare the repository for forking.
</pending_tasks>
<current_work>
The AI engineer had just successfully completed a major, multi-day debugging and enhancement effort on the Kaltakquise (Cold Acquisition) Autopilot. The system is now fully functional: it correctly crawls for new leads, analyzes them using OpenAI, filters for prospects with valid emails, sends out personalized HTML emails, and correctly skips prospects that fail or have no email, thus avoiding previous infinite loops.

Immediately before the summary request, the engineer was finalizing the UI based on user feedback. The last two actions were:

1.  **Fixing a UI Bug:** Corrected an input field for the Autopilot's Tageslimit (Daily Limit) in . The user reported that the number couldn't be edited correctly and the text color was wrong. The  was changed from number to text with a numeric pattern, and the  was bound to a separate state variable to fix the issue.

2.  **Preparing for Documentation:** The user confirmed they wanted to fork the project. The engineer's next step was to create the final handover documentation in . An attempt to create a new  failed because the file already existed, indicating the next step is to *edit* the existing file.
</current_work>
<optional_next_step>
Update the existing  file with comprehensive project documentation, as requested by the user for forking.
</optional_next_step>
