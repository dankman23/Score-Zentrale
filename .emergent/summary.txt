<analysis>
The user, communicating in German, initiated a debugging session for a Kaltakquise (Cold Acquisition) Autopilot module that was stuck. My predecessor, an AI engineer, undertook an extensive and complex series of debugging and feature enhancement tasks.

The initial investigation revealed that the Autopilot was repeatedly emailing the same prospect because a database status update was failing silently due to a data type mismatch (string uid=0(root) gid=0(root) groups=0(root) vs. MongoDB ). After fixing this, a cascade of further issues was identified and resolved.

Key actions included:
1.  **Debugging & Data Integrity:** Correcting the  issue, normalizing website URLs to remove sub-paths (e.g., ), and cleaning company names (e.g., removing Impressum - ) both in the code and via data-cleanup scripts (, ). A critical bug involving duplicate service files ( vs. ) was also found and fixed.
2.  **Test Mode Implementation:** An  was introduced using an environment variable to redirect all outgoing emails to a BCC address for safe testing. This required an emergency stop and restart when it was discovered that emails were still going out live.
3.  **Email Content Overhaul:** The user provided a detailed brief to improve email quality. This led to a complete rewrite of the email generation logic in , integrating  with a detailed, structured prompt to create highly personalized, human-like emails.
4.  **Prompt Management UI:** A new feature was built to manage and A/B test different email prompts. This involved creating a new MongoDB collection (), a new API endpoint (), and a complex new UI view within the main  file, which required significant debugging to render correctly.
5.  **Go-Live:** After all fixes and features were implemented and tested, the system was put into live mode by disabling the test mode and resetting test prospects.

The session concluded with several final small-but-critical bug fixes, such as  in the subject line and adding a proper salutation and legal signature. The user's final request was to update documentation. The next agent must respond in **German**.
</analysis>

<product_requirements>
The primary goal is a fully automated B2B cold acquisition Autopilot. The system must find new prospects, analyze their websites to extract contact information and business context, and engage them with personalized emails.

**Initial Problem:** The Autopilot was stalled, not processing new leads, and sending repetitive emails to the same address. The UI did not reflect the system's true state.

**Implemented Solution & Features:**
1.  **Functional Autopilot:** The core bugs were fixed. The Autopilot now reliably moves prospects through the pipeline:  ->  -> .
2.  **Data Cleaning:** Prospect data is automatically cleaned. Website URLs are normalized to the root domain, and company names are sanitized (e.g., Impressum - Company becomes Company).
3.  **Advanced Email Generation:** Emails are now generated by  using a highly specific, user-defined prompt to ensure a personal, non-robotic tone, incorporating details from the prospect analysis.
4.  **Prompt Management System:** A new Mail Prompts tab was added to the UI, allowing the user to create, edit, and A/B test different email prompts. The system tracks which prompt version was used for each sent email.
5.  **Live & Test Modes:** The application can be switched between a live mode (sending real emails) and a test mode (sending all emails to a predefined BCC address).
</product_requirements>

<key_technical_concepts>
- **Backend:** Next.js API Routes (TypeScript).
- **Database:** MongoDB. Critical fixes involved handling  correctly, running complex aggregation and update queries, and managing multiple collections (, ).
- **AI Integration:** Using  via an API for dynamic, prompt-driven email content generation. The logic includes a robust fallback template.
- **Environment & Debugging:** Use of  variables (, API keys) and code-server                      STOPPED   Not started
jtl-import                       STOPPED   Not started
mongodb                          RUNNING   pid 28, uptime 0:00:02
nextjs                           STOPPED   Nov 19 11:26 PM
nginx-code-proxy                 RUNNING   pid 26, uptime 0:00:02
supervisor>  for service restarts. Debugging relied on server logs and direct database inspection.
- **Frontend:** A large, monolithic React component () with complex state management (, ) to handle different UI views and data fetching.
</key_technical_concepts>

<code_architecture>
The application is a Next.js monolith. The backend is built with API routes and services, and the frontend is a single large client component.

**Directory Structure:**


- ****
  - **Importance:** The core of the Autopilot. This endpoint orchestrates the entire workflow: finding prospects to contact, triggering analysis, or finding new companies to crawl.
  - **Changes:** Logic was improved to first prioritize sending emails to already-analyzed prospects before crawling for new ones, making it more efficient.

- ****
  - **Importance:** Contains all logic for generating email content. This file was the focus of major feature enhancements.
  - **Changes:** It was completely refactored to integrate with . It now constructs a detailed prompt based on user specifications, fetches the active prompt from the database, calls the AI, parses the response, and has a robust fallback. It also adds a proper salutation and a full legal signature. The  is now saved with the email.

- ****
  - **Importance:** The main UI file for the entire Kaltakquise tool. It handles rendering for all prospects, stats, and tabs.
  - **Changes:** A new Mail Prompts tab and a corresponding view () were added. This involved adding state, fetch logic for prompts, and modals for CRUD operations. A significant amount of debugging was done to fix rendering and navigation issues, ensuring the main navigation tabs are always visible. A Zur√ºck (Back) button was added and later removed in favor of a persistent tab bar.

- ** (directory)**
  - **Importance:** Contains one-off scripts for database maintenance and initialization.
  - **Changes:** Several scripts were created to perform critical data cleanup (, ) and to initialize the new prompt management feature ().

- ** & **
  - **Importance:** Contains logic for crawling websites. A critical bug was discovered where two versions of this file existed, causing fixes to not apply.
  - **Changes:** The correct file () was updated to normalize URLs upon saving and to properly clean company names derived from page titles.
</code_architecture>

<pending_tasks>
- **Project Documentation:** The user has explicitly requested to create/update the project documentation in  files now that the feature work is complete. This task is pending.
</pending_tasks>

<current_work>
The last set of tasks involved final polish and going live with the Autopilot.

1.  **Final Polish:** The user requested several final adjustments:
    *   Fixed Herr Unbekannt in salutations by adding a filter for the name Unbekannt.
    *   Added a full legal signature to the bottom of all emails.
    *   Modified the call-to-action (CTA) text in the email, which involved updating both the ChatGPT prompt in the database and the fallback template in .

2.  **Going Live:** At the user's request, the system was switched from test mode to live mode.
    *   The  environment variable was set to .
    *   The BCC list in  was updated to the single required address.
    *   ~50 prospects who were contacted during testing were reset to the analyzed status so they could receive a real email.
    *   The server was restarted, and a live email send was verified via the logs, confirming the correct  and  recipients.

3.  **Final Bug Fixes Post-Live:**
    *   A critical bug causing  in email subjects was fixed by correcting how a variable was accessed in .
    *   A bug where the salutation was missing was fixed by explicitly prepending it to the generated email body.

The system is now fully operational, live, and incorporates all user-requested features and bug fixes. The immediate task before this summary was updating the CTA.
</current_work>

<optional_next_step>
Complete the user's final request: create and update the project documentation in  files.
</optional_next_step>
