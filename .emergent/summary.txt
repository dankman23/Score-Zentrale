<analysis>
The trajectory outlines a comprehensive development process for a Score-Zentrale application, focusing on its outbound module. The initial phase involved a thorough, read-only analysis of the existing Kaltakquise (cold acquisition) module, culminating in a detailed report on its architecture, workflows, and identified issues, along with a strategic roadmap.

The second phase was reactive, addressing critical user-reported bugs. This involved debugging a stalled Autopilot worker, which was caused by a state desynchronization between the frontend and the database, and fixing a misconfigured email BCC functionality by correcting mismatched environment variable names in the email service code.

The third and most extensive phase involved a major feature overhaul based on new user requirements. The goal was to build a central customer management system. This necessitated creating new UI tabs (Kunden, Warmakquise) and backend infrastructure in parallel with the existing Kaltakquise module to avoid disruption. Development involved creating new API endpoints for importing and enriching customer data from an external JTL (MSSQL) database, updating the data model to include metrics like total revenue and order count, and building a new frontend component to display this data. The most recent task is debugging a persistent SQL error within the JTL customer import logic, where the AI is struggling to identify the correct column names for order data, blocking the completion of the import feature.

Based on the trajectory, the user's primary language is **German**. All future responses should be in German.
</analysis>

<product_requirements>
The application, Score-Zentrale, is a business intelligence suite. The current focus is on the Outbound module, which is being restructured into three distinct functional tabs:

1.  **Kaltakquise (Cold Acquisition - Mostly Complete & Stable):** An automated system for finding, analyzing, and contacting new leads. It includes a DACH-region web crawler, an LLM-based website analyzer, a multi-stage email sequence generator, and an Autopilot worker to orchestrate the process. The core functionality is stable after several critical bug fixes.

2.  **Kunden (Customers - In Development):** A new, central customer relationship management hub. The core requirement is to perform a one-time and subsequent nightly import of all customers from an external JTL-Wawi (MSSQL) database into the application's MongoDB. This import must enrich the customer data by calculating total revenue, order count, B2B status, last order date, sales channel, and the most purchased product category. The system must use an upsert logic to update existing records without deleting custom data (like warm-acquisition scores).

3.  **Warmakquise (Warm Acquisition - Planned):** A tab intended for re-engaging existing customers. The data for this, particularly a warm_aquise_score, was lost and needs to be preserved by the new customer import logic.
</product_requirements>

<key_technical_concepts>
- **Frameworks:** Next.js (App Router), React
- **Backend:** Next.js API Routes, TypeScript, Node.js
- **Databases:**
    - MongoDB: Primary application database.
    - Microsoft SQL Server (MSSQL): External JTL-Wawi ERP data source.
- **Key Logic:**
    - ETL Process: Extracting from MSSQL, transforming/enriching data (e.g., calculating revenue, B2B status), and loading/upserting into MongoDB.
    - Background Worker: A -managed Node.js script for the Autopilot feature, which runs periodic tasks.
    - Third-Party APIs: Google Custom Search, Jina.ai (for web crawling), and GPT models (for analysis).
</key_technical_concepts>

<code_architecture>
The application is a Next.js monolith. The frontend is a large single-page application () with tab-based navigation. The backend consists of API routes for different modules.

**Directory Structure (Key Files):**


-   ** & **
    -   **Importance:** These are the core frontend files.  contains the UI logic for all tabs, including state management for the Kaltakquise and the new Kunden/Warmakquise tabs.  contains the main navigation structure.
    -   **Changes:** Heavily modified to add new navigation items and tabs for Kunden and Warmakquise. A periodic polling mechanism was added to sync the Autopilot status. UI elements for JTL import and CSV export were added. A major bug involving a duplicate, overlapping navigation menu was fixed.

-   ****
    -   **Importance:** This is the central API for the new customer management feature. It contains the complex logic to fetch all customers and their orders from the JTL MSSQL database, perform data enrichment (B2B/channel detection, revenue calculation), and upsert the results into MongoDB.
    -   **Changes:** Newly created and iteratively developed. Currently blocked by SQL errors as it contains incorrect column names for the  table (e.g., ).

-   ****
    -   **Importance:** Handles all outgoing SMTP emails.
    -   **Changes:** Corrected to use the proper environment variables (, ) instead of misnamed ones, fixing a critical bug where BCC emails were not being sent correctly.

-   ****
    -   **Importance:** A new React component created to encapsulate the entire UI for the Kunden tab, including the customer list, statistics, and import button.
    -   **Changes:** Newly created to separate concerns from the massive  file. It fetches data from the  endpoint and displays it in a table with the user-requested columns.

-   ** & **
    -   **Importance:** Created to solve the recurring issue of not knowing the correct JTL database schema. The goal is to create a central, reliable source of truth for JTL table and column names that future agents can reference and update.
    -   **Changes:** Newly created in response to repeated SQL failures.
</code_architecture>

<pending_tasks>
- **Fix JTL Customer Import:** Resolve the SQL errors in  to make the customer import functional.
- **Implement Customer Detail View:** The user requested a detail view showing all of a customer's orders, email, and address. This has not been implemented.
- **Implement Nightly Sync:** The daily sync is currently triggered by a button press. A cron job or scheduled task needs to be set up to run it automatically at night.
- **Complete Original Roadmap:** Many items from the initial analysis are still open, including full ID standardization, a UI for email prompt management, and batch operations for analysis.
</pending_tasks>

<current_work>
The immediate focus is on debugging the critical JTL customer import feature, which is the cornerstone of the new Kunden tab. The user reported that clicking the JTL-Sync button fails and no customers are imported.

The investigation traced the issue to the backend API endpoint at . This endpoint is throwing a 500 server error due to an invalid SQL query. Specifically, the query attempts to select columns like  and  from the JTL database tables (, ), but these column names are incorrect, resulting in an Invalid column name error from the MSSQL driver.

The previous engineer's last actions were attempts to find the correct column names. This involved:
1.  Trying to fix typos ( -> ), which also failed.
2.  Trying to access the provided JTL database documentation URL, which was a dead link (404).
3.  Crawling the main JTL database documentation website. This returned a massive list of all tables, which was not immediately helpful.

The work is currently stalled at this point: the import is completely broken, and the correct database schema for order information is still unknown. The last action was to search for the  table within the huge amount of crawled text from the JTL documentation website to pinpoint the correct column names for total order value and item quantity.
</current_work>

<optional_next_step>
Continue the debugging process by thoroughly searching the crawled JTL documentation for the  and  table schemas to find the correct column names for order total and quantity.
</optional_next_step>
